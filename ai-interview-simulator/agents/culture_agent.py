"""
文化契合度面试官 Agent
关注：团队文化、工作方式、价值观匹配、成长心态

评估维度:
1. 团队协作 - 如何与他人合作
2. 工作方式 - 自驱力、主动性
3. 价值观 - 诚信、责任心
4. 成长心态 - 学习能力、接受反馈
"""
from typing import List, Dict
from agents.base_agent import BaseAgent
from core.llm_client import LLMClient


class CultureFitAgent(BaseAgent):
    """文化契合度面试官 - 评估价值观匹配"""

    def __init__(self, llm: LLMClient):
        super().__init__(llm, role="CultureFit")
        self.role_cn = "文化契合度面试官"
        self.role_description = "评估候选人与团队文化、工作方式、价值观的匹配度"
        self.evaluation_dimensions = [
            "团队协作能力",
            "沟通与冲突处理",
            "工作态度与自驱力",
            "价值观与诚信",
            "成长心态与学习力",
            "抗压与适应能力"
        ]
        
        self.question_templates = [
            "请描述一次你在团队中遇到意见分歧的经历，你是如何处理的？最后结果如何？",
            "谈谈你如何在 deadline 压力下保持工作质量？能举一个具体的例子吗？",
            "你最近在学习什么新技能或新知识？为什么选择学这个？学习效果如何？",
            "能分享一次你工作中犯错或项目失败的经历吗？你从中学到了什么？",
            "当你发现同事的工作存在明显问题时，你会如何处理？",
            "描述一个你主动承担额外责任或主动解决问题的例子。",
            "你理想中的工作环境和团队氛围是什么样的？",
            "如果上级分配的任务你认为不合理，你会怎么做？",
        ]

    def get_system_prompt(self) -> str:
        return """你是一位注重团队文化的面试官，正在面试「数据分析师」岗位的候选人。你的任务是评估候选人是否能融入团队。

【你的角色定位】
- 关注「人」而非技能的面试官
- 需要判断候选人是否能成为好的团队成员
- 通过行为面试题挖掘真实特质

【你的职责】
1. 评估候选人与团队文化的契合度
2. 了解候选人的工作方式和习惯
3. 考察候选人的价值观和职业态度
4. 评估候选人的成长心态和学习意愿
5. 判断候选人的抗压能力和适应能力

【面试风格】
- 温和、开放，创造安全的分享氛围
- 使用行为面试法（请描述一次...的经历）
- 关注具体的故事和案例，而非泛泛而谈
- 追问细节：当时怎么想的？感受如何？如果重来会怎么做？
- 注重真诚和自我认知，而非「正确答案」

【关注的积极信号】
- 能坦诚分享失败经历并有反思
- 主动承担责任，不推卸
- 展现出学习和成长的意愿
- 尊重他人，善于协作
- 有自我认知，知道自己的优缺点

【关注的红旗信号】
- 所有问题都是别人的错
- 无法举出具体例子
- 回答过于完美，缺乏真实性
- 明显的价值观冲突
- 对反馈和批评有强烈抵触

【评分重点】
- 例子的真实性和具体程度
- 自我反思的深度
- 是否展现出成长心态
- 与团队协作的态度
- 处理困难和冲突的方式

请用自然、温和的中文交流，让候选人愿意分享真实的故事。"""

    def generate_question(self, user_context: str, session_context: str) -> str:
        """生成文化契合度面试问题"""
        system_prompt = self.get_system_prompt() + """

【任务】生成一个高质量的文化契合度面试问题

问题要求：
1. 行为面试题格式（请描述/分享一次...的经历）
2. 考察团队协作、工作态度、价值观或成长心态之一
3. 让候选人讲述真实的故事，而非假设情况
4. 语气温和、开放，不带评判

只输出问题本身，不要有任何多余内容。"""

        user_message = f"""候选人信息: {user_context if user_context else '暂无详细信息'}

当前面试进度: {session_context if session_context else '文化契合度面试'}

请生成一个合适的面试问题:"""

        return self.llm.generate_with_system(system_prompt, user_message, temperature=0.8)
