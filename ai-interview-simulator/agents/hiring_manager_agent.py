"""
业务用人经理 Agent
关注：项目经历、业务理解、分析落地能力、跨部门协作

评估维度:
1. 项目经历深度 - 是否有实质性贡献
2. 业务理解能力 - 是否能理解业务问题
3. 分析落地能力 - 分析是否能转化为行动
4. 协作沟通能力 - 与非技术人员的沟通
"""
from typing import List, Dict
from agents.base_agent import BaseAgent
from core.llm_client import LLMClient


class HiringManagerAgent(BaseAgent):
    """业务用人经理 - 负责业务面试"""

    def __init__(self, llm: LLMClient):
        super().__init__(llm, role="HiringManager")
        self.role_cn = "业务用人经理"
        self.role_description = "负责业务面试，深挖项目经历，考察业务理解和分析落地能力"
        self.evaluation_dimensions = [
            "项目经历深度与贡献",
            "业务问题理解能力",
            "数据驱动决策能力",
            "分析落地与结果",
            "跨部门协作经验"
        ]
        
        self.question_templates = [
            "请详细介绍一个你主导或深度参与的数据分析项目，包括项目背景、你的角色、分析方法和最终结果。",
            "在你过往的工作中，有没有一次你的分析直接影响了重要的业务决策？请详细说说。",
            "当业务方提出一个模糊的分析需求时，你通常如何明确需求并推进项目？",
            "你如何向非技术背景的同事解释复杂的数据分析结果？有什么技巧或经验？",
            "描述一次你发现数据异常或有趣洞察的经历，你是如何发现的，后续做了什么？",
            "如果你的分析结论与业务方的直觉相悖，你会如何处理？",
        ]

    def get_system_prompt(self) -> str:
        return """你是一位资深的业务部门负责人，正在面试「数据分析师」岗位的候选人。你将是这位分析师的直接上级。

【你的角色定位】
- 业务团队的数据分析负责人
- 需要找到能真正解决业务问题的分析师
- 关注实际产出而非纸上谈兵

【你的职责】
1. 深挖候选人过往的数据分析项目经历，验证真实性和深度
2. 考察候选人对业务问题的理解能力
3. 评估候选人将分析结果转化为业务行动的能力
4. 了解候选人的跨部门沟通与协作经验

【面试风格】
- 务实、直接，注重细节
- 喜欢追问项目的具体数字和结果
- 会用 STAR 框架（情境-任务-行动-结果）来追问
- 关注「你」具体做了什么，而非团队整体
- 对模糊的回答会继续追问

【关注的红旗信号】
- 只说「我们团队」而说不清个人贡献
- 项目描述泛泛而谈，无具体数字
- 只做分析，不关心业务结果
- 无法解释分析方法的选择原因

【追问技巧】
当候选人说：
- 「我做了用户分析」→ 追问：分析了哪些维度？发现了什么？
- 「提升了转化率」→ 追问：具体提升了多少？如何归因到你的工作？
- 「和业务方合作」→ 追问：遇到分歧时如何处理？

【评分重点】
- 项目复杂度和个人贡献度
- 是否有量化的业务结果
- 分析思路是否清晰
- 是否能站在业务角度思考

请用自然的中文交流，像真正的用人经理面试下属一样。"""

    def generate_question(self, user_context: str, session_context: str) -> str:
        """生成业务面试问题"""
        system_prompt = self.get_system_prompt() + """

【任务】生成一个高质量的业务面试问题

问题要求：
1. 考察项目经历、业务理解或协作能力之一
2. 最好能用 STAR 结构回答的行为问题
3. 问题要具体，避免太宽泛
4. 与数据分析师的实际工作相关

只输出问题本身，不要有任何多余内容。"""

        user_message = f"""候选人信息: {user_context if user_context else '暂无详细信息'}

当前面试进度: {session_context if session_context else '业务用人经理面试'}

请生成一个合适的业务面试问题:"""

        return self.llm.generate_with_system(system_prompt, user_message, temperature=0.8)
